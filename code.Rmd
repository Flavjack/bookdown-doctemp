
```{r import_data}

fb <- gs %>% 
  gs_read(ws = "prosopis") %>% 
  select_all(funs(tolower)) %>%            
  select_all(funs(gsub("\\s+|\\.", "_", .))) %>% 
  mutate_if(is.character, funs(tolower)) %>% 
  mutate_if(is.character, funs(gsub("\\s+|\\.", "_", .))) %>% 
  
  mutate_at(vars(rep, nacl, temp), funs(as.character))

openxlsx::write.xlsx(x = fb, file = "img/data_set.xlsx")
utils::zip(zipfile = "docs/files.zip", files = "img/data_set.xlsx")

```

# Tables {-}

```{r functions}

tb <- dplyr::data_frame(
  
  "Function" = c("ger_summary", "ger_intime", "fplot", "GerminaQuant", "prosopis"),
  
  "Description"= c(
    
    "Calculate ten germination indices maintaining the factors levels for analysis of variance",
    "Calculates and displays cumulative germination data.",
    "Function that allows to graphic the results in bar or line plot.",
    "Runs the interactive application in offline mode for use on a personal computer.",
    "Dataset with germination experiment in *Prosopis juliflor* seeds under under different osmotic potentials and temperatures.")
  
)

tb %>% 
  knitr::kable(
    booktabs = TRUE,
    format = "pandoc",
    caption = "Main functions in the GerminaR R package for seed germination variables and graphical analysis.")

```

# Figures {-}

(ref:gerplot) Germination  experiment with *Prosopis juliflor* under different osmotic potentials and temperatures. A) Bar graph with germination percentage in a factorial analisys. B)  Line graph from cumulative germination under different osmotic potentials.

```{r germplot, fig.align='center', fig.cap= '(ref:gerplot)'}

## Puntual analysis

# germination analysis

gsm <- ger_summary(SeedN = "seeds", evalName = "d", data = fb)

# analisys of variance

av <- aov(formula = GRP ~ nacl*temp + rep, data = gsm)

# mean comparision test

mc <- ger_testcomp(aov = av, comp = c("temp", "nacl"), type = "snk")

# line or bar graphics

gbp <- fplot(data = mc, type = "bar", 
             x = "temp", y = "mean", z = "nacl", 
             lmt = c(0,110), brk = 10,
             ylab = "Germination ('%')", 
             xlab = "Temperature (ÂºC)", 
             lgl = "NaCl (Mpa)", lgd = "top", 
             sig = "sg", erb = T, color = F)

## Intime analysis

# data frame with percentual or relative germination in time

git <- ger_intime(Factor = "nacl", SeedN = "seeds", evalName = "d", method = "percentage", data = fb)

# graphic germination in time

ggt <- fplot(data = git, type = "line", 
             x = "evaluation", y = "mean", z = "nacl", 
             lmt = c(0,110), brk = 10,
             ylab = "Germination ('%')", 
             xlab = "Day", 
             lgl = "NaCl (Mpa)", 
             lgd = "top", color = FALSE)

## Plot figures

gerplot <- cowplot::ggdraw(xlim = c(0, 1), ylim = c(0, 0.5))+
  draw_plot(gbp, width = 0.5, height = 0.5, x = 0.0, y = 0.0) +
  draw_plot(ggt, width = 0.5, height = 0.5, x = 0.5, y = 0.0) +
  draw_plot_label(label = c("A", "B"), x = c(0.0, 0.5), y = c(0.5, 0.5))

cowplot::ggsave("img/fig_gerplot.tiff", dpi= 300, width = 210*0.9 , height = 297*0.4, units = "mm")
cowplot::ggsave("img/fig_gerplot.png", dpi= 300, width = 210*0.9 , height = 297*0.4, units = "mm")

knitr::include_graphics("img/fig_gerplot.png")

```


```{r, fig.align='center', fig.cap= "Plant of *Jatropha curcas*. A) Foliage, B) Leaf, C) Fruit."}

fg <- jpeg::readJPEG("img/fig_jc.jpg") %>% 
  grid::rasterGrob(interpolate = TRUE)

plot <- cowplot::ggdraw(xlim = c(0, 0.5), ylim = c(0, 0.5))+
  draw_plot(fg, width = 0.5, height = 0.5, x = 0.0, y = 0.0) +
  draw_plot_label(label = c("A", "B", "C"),
                  x = c(0.01, 0.26, 0.01), 
                  y = c(0.48, 0.48, 0.15))

cowplot::ggsave("img/fig_jcurcas.png", dpi= 300, width = 210*0.5 , height = 297*0.3, units = "mm")
cowplot::ggsave("img/fig_jcurcas.tiff", dpi= 300, width = 210*0.5 , height = 297*0.3, units = "mm")

include_graphics("img/fig_jcurcas.png")

```


```{r, fig.align= 'center', fig.cap= "Multivariate Analysis: Principal component Analysis and Hierarchical Clustering Analysis."}

# Principal componet Analysis

pca <- gsm %>% 
  drop_na() %>% 
  # select_if(., is.numeric) %>% 
  select(nacl, temp, GRP, MGT, UNC, SYN) %>% 
  
  PCA(X = ., 
      scale.unit = T,
      graph = F,
      quali.sup = c(1,2))


# summary.PCA(pca, nb.dec = 2, nbelements = Inf)
# dimdesc(pca)

# library(FactoInvestigate)
# Investigate(pca, document = "pdf_document")

ppi <- 300
png("img/fig_pca_var.png", width=7*ppi, height=7*ppi, res=ppi)

plot.PCA(pca,
         choix="var",
         title="",
         autoLab = "y", 
         cex = 0.8,
         shadowtext = T)

graphics.off()

ppi <- 300
png("img/fig_pca_ind.png", width=7*ppi, height=7*ppi, res=ppi)

plot.PCA(pca,
         choix="ind",
         habillage = 1,
         title="",
         autoLab = "y", 
         cex = 0.8,
         shadowtext = T,
         label = "ind",
         legend = list(bty = "y", x = "topright"))

graphics.off()


# Hierarchical Clustering Analysis

clt <- pca %>% 
  FactoMineR::HCPC(., nb.clust=-1, graph = F)

# clt$call$t$tree
# clt$desc.ind
# clt$desc.var

ppi <- 300
png("img/fig_cluster_tree.png", width=7*ppi, height=7*ppi, res=ppi)

plot.HCPC(x = clt, 
          choice = "tree")

graphics.off()


ppi <- 300
png("img/fig_cluster_map.png", width=7*ppi, height=7*ppi, res=ppi)

plot.HCPC(x = clt, choice = "map")

graphics.off()


fg_01 <- png::readPNG("img/fig_pca_var.png") %>% 
  grid::rasterGrob(interpolate = TRUE)

fg_02 <- png::readPNG("img/fig_pca_ind.png") %>% 
  grid::rasterGrob(interpolate = TRUE)

fg_03 <- png::readPNG("img/fig_cluster_tree.png") %>% 
  grid::rasterGrob(interpolate = TRUE)

fg_04 <- png::readPNG("img/fig_cluster_map.png") %>% 
  grid::rasterGrob(interpolate = TRUE)


plot <- cowplot::ggdraw(xlim = c(0, 1), ylim = c(0, 1))+
  draw_plot(fg_01, width = 0.5, height = 0.5, x = 0.0, y = 0.5) +
  draw_plot(fg_02, width = 0.5, height = 0.5, x = 0.5, y = 0.5) +
  draw_plot(fg_03, width = 0.5, height = 0.5, x = 0.0, y = 0.0) +
  draw_plot(fg_04, width = 0.5, height = 0.5, x = 0.5, y = 0.0) +
  draw_plot_label(label = c("A", "B", "C", "D"),
                  x = c(0.0, 0.5, 0.0, 0.5 ), 
                  y = c(0.98, 0.98, 0.48, 0.48))


cowplot::ggsave("img/fig_mv.png", dpi= 300, width = 210*1 , height = 297*0.7, units = "mm")
cowplot::ggsave("img/fig_mv.tiff", dpi= 300, width = 210*1 , height = 297*0.7, units = "mm")

include_graphics("img/fig_mv.png")

```

<a href="img/fig_mv.tiff" download><button>Download</button> </a>

# Anexos {-}

<embed src="img/docx/mensh_&_kording_2017.pdf" width="100%" height="600" alt="pdf" pluginspage="http://www.adobe.com/products/acrobat/readstep2.html">

